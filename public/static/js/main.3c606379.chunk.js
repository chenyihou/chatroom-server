(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{170:function(e,t,a){e.exports=a(322)},322:function(e,t,a){"use strict";a.r(t);var n=a(164),r=a(1),l=a.n(r),o=a(4),c=a.n(o),s=a(23),u=a(165),i=a(342),m=a(340),p=a(341),d=a(343),f=a(24),h=a(25),g=a.n(h),E=a(186);function v(){var e=Object(f.a)([" { allUsers{ id,username } } "]);return v=function(){return e},e}var y=function(){return l.a.createElement("div",{style:{display:"flex",alignContent:"center ",justifyContent:"center",height:"100vh"}},l.a.createElement(s.Query,{query:g()(v())},function(e){var t=e.loading,a=e.error,n=e.data;return t?l.a.createElement(E.a,null):a?l.a.createElement("p",null,a,"error"):(console.log(n),n.allUsers.map(function(e){var t=e.id,a=e.username;return l.a.createElement("div",{key:t},l.a.createElement("p",null,a))}))}))},b=a(28),w=a.n(b),j=a(42),k=a(56),O=a(57),x=a(60),S=a(58),I=a(61),C=a(339),M=a(333),P=a(336),$=a(12),q=a(337),N=a(323);function T(){var e=Object(f.a)(["\n    mutation ($username: String!, $email: String!, $password: String!) {\n        register(username: $username, email: $email, password: $password) {\n            ok\n            errors {\n                path\n                message\n            }\n        }\n    }\n"]);return T=function(){return e},e}var A=g()(T()),F={display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},Q=function(e){function t(){var e,a;Object(k.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(x.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).sendMsg=function(){var e=Object(j.a)(w.a.mark(function e(t,n){var r,l,o,c,s,u,i;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.username,l=t.password,o=t.email,e.next=3,n({variables:{username:r,email:o,password:l}});case 3:c=e.sent,s=c.data.register,u=s.ok,i=s.errors,u?(C.a.success("Register successfully"),a.props.history.push("/login")):(i.forEach(function(e){C.a.error(e.message)}),console.log(a.state));case 6:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),a.handleSubmit=function(){var e=Object(j.a)(w.a.mark(function e(t,n){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a.props.form.validateFields(function(e,t){e||a.sendMsg(t,n)});case 2:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),a}return Object(I.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator;return l.a.createElement("div",{style:F},l.a.createElement(s.Mutation,{mutation:A},function(a,n){n.data;return l.a.createElement(M.a,{onSubmit:function(t){return e.handleSubmit(t,a)},className:"login-form",style:{}},l.a.createElement(M.a.Item,null,t("username",{rules:[{required:!0,message:"Please input your username!"}]})(l.a.createElement(P.a,{name:"username",prefix:l.a.createElement($.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),l.a.createElement(M.a.Item,null,t("email",{rules:[{required:!0,message:"Please input your email!"}]})(l.a.createElement(P.a,{name:"email",prefix:l.a.createElement($.a,{type:"mail",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Email"}))),l.a.createElement(M.a.Item,null,t("password",{rules:[{required:!0,message:"Please input your Password!"}]})(l.a.createElement(P.a,{name:"password",type:"password",prefix:l.a.createElement($.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Password"}))),l.a.createElement(M.a.Item,null,t("remember",{valuePropName:"checked",initialValue:!0})(l.a.createElement(q.a,null,"Remember me")),l.a.createElement(N.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Register")))}))}}]),t}(l.a.Component),R=M.a.create()(Q),U=function(){return l.a.createElement("div",null,l.a.createElement($.a,{type:"home"}),"  Chat Room")},D=a(334),L=a(330);function _(){var e=Object(f.a)([" { allUsers{ id,username, } } "]);return _=function(){return e},e}var z=function(){return l.a.createElement(s.Query,{query:g()(_())},function(e){var t=e.loading,a=e.error,n=e.data;return t?l.a.createElement(E.a,null):a?l.a.createElement("p",null,a,"error"):(console.log(n,"data"),l.a.createElement(D.a,{itemLayout:"horizontal",dataSource:n.allUsers,renderItem:function(e){return l.a.createElement(D.a.Item,null,l.a.createElement(D.a.Item.Meta,{avatar:l.a.createElement(L.a,{icon:"user"}),title:l.a.createElement("a",{href:"https://ant.design"}," ",e.username," "),description:e.description||""}))}}))})},J=a(331);function V(){var e=Object(f.a)([" { allMessages{\n    id\n    text\n    created_at\n    user{\n      id\n      username\n    }\n  } } "]);return V=function(){return e},e}function B(){var e=Object(f.a)(["\nmutation ($text:String!){\n    createMessage( text: $text){\n        id\n        text\n        user{\n          id\n          username\n        }\n        created_at\n      }\n  }\n"]);return B=function(){return e},e}var H=P.a.TextArea,Y=function(e){var t=e.onChange,a=e.onSubmit,n=e.value;return l.a.createElement("div",null,l.a.createElement(M.a.Item,null,l.a.createElement(H,{rows:4,onChange:t,value:n})),l.a.createElement(M.a.Item,null,l.a.createElement(N.a,{htmlType:"submit",onClick:a,type:"primary"},"Add Comment")))},G=function(e){function t(){var e,a;Object(k.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(x.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={value:""},a.handleSubmit=Object(j.a)(w.a.mark(function e(){var t;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.props.send,e.next=3,t({variables:{text:a.state.value}});case 3:if(!e.sent){e.next=8;break}C.a.success("Message is sent"),a.setState({value:""}),e.next=9;break;case 8:C.a.error("Message is not sent");case 9:case"end":return e.stop()}},e,this)})),a.handleChange=function(e){a.setState({value:e.target.value})},a}return Object(I.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this.state.value;return l.a.createElement("div",null,l.a.createElement(J.a,{avatar:l.a.createElement(L.a,{icon:"user"}),content:l.a.createElement(Y,{onChange:this.handleChange,onSubmit:this.handleSubmit,value:e})}))}}]),t}(l.a.Component),K=g()(B()),W=g()(V()),X=function(){return l.a.createElement(s.Mutation,{mutation:K,update:function(e,t){var a=t.data.createMessage,n=e.readQuery({query:W}).allMessages;console.log(a),e.writeQuery({query:W,data:{allMessages:n.concat([a])}})}},function(e,t){return t.data,l.a.createElement(G,{send:e})})},Z=function(e){var t=e.data;return l.a.createElement("div",{style:{overflow:"scroll",height:"60vh"}},l.a.createElement(D.a,{className:"comment-list",itemLayout:"horizontal",dataSource:t,renderItem:function(e){return l.a.createElement(J.a,{actions:e.actions,author:e.author,avatar:e.avatar,content:e.content,datetime:e.datetime})}}))},ee=a(160),te=a.n(ee);function ae(){var e=Object(f.a)([" { allMessages{\n        id\n        text\n        created_at\n        user{\n          id\n          username\n        }\n      } } "]);return ae=function(){return e},e}var ne=function(){return l.a.createElement(s.Query,{query:g()(ae())},function(e){var t=e.loading,a=e.error,n=e.data;return t?l.a.createElement(E.a,null):a?l.a.createElement("p",null,a,"error"):(console.log(n),n=n.allMessages.map(function(e){e.id;var t=e.text,a=e.user,n=e.created_at;return{author:a.username,content:t,avatar:l.a.createElement(L.a,{icon:"user"}),datetime:te()(parseInt(n)).fromNow()}}),l.a.createElement(Z,{data:n}))})},re=a(338),le=re.a.Header,oe=re.a.Footer,ce=re.a.Sider,se=re.a.Content,ue=function(){return l.a.createElement(re.a,{style:{height:"100vh"}},l.a.createElement(ce,{style:{backgroundColor:"transparent",overflowY:"scroll"}},l.a.createElement(z,null)),l.a.createElement(re.a,null,l.a.createElement(le,{style:{backgroundColor:"transparent"}},l.a.createElement(U,null)),l.a.createElement(se,null,l.a.createElement(ne,null)),l.a.createElement(oe,null,l.a.createElement(X,{name:"name"}))))},ie=a(332);function me(){var e=Object(f.a)(["\n    mutation ( $email: String!, $password: String!) {\n        login(email: $email, password: $password) {\n            ok\n            errors {\n                path\n                message\n            }\n            token\n            refreshToken\n        }\n    }\n"]);return me=function(){return e},e}var pe=g()(me()),de={display:"flex",alignItems:"center",justifyContent:"center",height:"100vh"},fe=function(e){function t(){var e,a;Object(k.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(x.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).sendMsg=function(){var e=Object(j.a)(w.a.mark(function e(t,n){var r,l,o,c,s,u,i,m,p;return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.password,l=t.email,e.next=3,n({variables:{email:l,password:r}});case 3:o=e.sent,c=o.data.login,s=c.ok,u=c.errors,i=c.token,m=c.refreshToken,s?(localStorage.setItem("token",i),localStorage.setItem("refreshToken",m),C.a.success("Login successfully"),p=a.props.location.state||{from:{pathname:"/"}},p.from,a.props.history.push("/chatroom")):(u.forEach(function(e){C.a.error(e.message)}),console.log(a.state));case 6:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),a.handleSubmit=function(){var e=Object(j.a)(w.a.mark(function e(t,n){return w.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault(),a.props.form.validateFields(function(e,t){e||a.sendMsg(t,n)});case 2:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),a}return Object(I.a)(t,e),Object(O.a)(t,[{key:"render",value:function(){var e=this,t=this.props.form.getFieldDecorator;return l.a.createElement("div",{style:de},l.a.createElement(s.Mutation,{mutation:pe},function(a,n){n.data;return l.a.createElement(M.a,{onSubmit:function(t){return e.handleSubmit(t,a)},className:"login-form",style:{}},l.a.createElement(M.a.Item,null,t("email",{rules:[{required:!0,message:"Please input your email!"}]})(l.a.createElement(P.a,{name:"email",prefix:l.a.createElement($.a,{type:"mail",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Email"}))),l.a.createElement(M.a.Item,null,t("password",{rules:[{required:!0,message:"Please input your Password!"}]})(l.a.createElement(P.a,{name:"password",type:"password",prefix:l.a.createElement($.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Password"}))),l.a.createElement(M.a.Item,null,t("remember",{valuePropName:"checked",initialValue:!0})(l.a.createElement(q.a,null,"Remember me")),l.a.createElement(N.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Log In"),l.a.createElement("br",null),"Or ",l.a.createElement(ie.a,{to:"/register"},"register now!")))}))}}]),t}(l.a.Component),he=M.a.create()(fe),ge=a(123),Ee=a.n(ge),ve=function(e){var t=e.component,a=Object(u.a)(e,["component"]);return l.a.createElement(i.a,Object.assign({},a,{render:function(e){return function(){var e=localStorage.getItem("token"),t=localStorage.getItem("refreshToken");try{Ee()(e),Ee()(t)}catch(a){return!1}return!0}()?l.a.createElement(t,e):l.a.createElement(m.a,{to:{pathname:"/login",state:{from:e.location}}})}}))},ye=function(){return l.a.createElement(p.a,null,l.a.createElement(d.a,null,l.a.createElement(ve,{exact:!0,path:"/",component:y}),l.a.createElement(ve,{path:"/chatroom",component:ue}),l.a.createElement(i.a,{path:"/register",component:R}),l.a.createElement(i.a,{path:"/login",component:he})))},be=(a(314),a(145)),we=a(163),je=a(162),ke=a(335),Oe=Object(we.a)({uri:"http://99.79.9.127:4000/graphql"}),xe=Object(je.a)(function(e,t){var a=t.headers,r=localStorage.getItem("token");return{headers:Object(n.a)({},a,{authorization:r?"".concat(r):""})}}),Se=new be.a({link:xe.concat(Oe),cache:new ke.a});c.a.render(l.a.createElement(function(){return l.a.createElement(s.ApolloProvider,{client:Se},l.a.createElement(ye,null))},null),document.getElementById("root"))}},[[170,2,1]]]);
//# sourceMappingURL=main.3c606379.chunk.js.map